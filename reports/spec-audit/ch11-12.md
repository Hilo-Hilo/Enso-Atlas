# Chapter 11–12 spec audit (high-confidence mismatches only)

## 1) Annotation audit logging is overstated

**Old (TECHNICAL_SPECIFICATION.md §11.5):**
> All annotation operations are logged to the audit trail.

**New (suggested):**
> Annotation create/delete are logged to the audit trail; update/list/summary are currently not audit-logged.

---

## 2) Heatmap cache path and cache conditions are inaccurate

**Old (§12.1 “Disk-Based Caching”):**
> Heatmaps are cached to `data/embeddings/heatmap_cache/{slide_id}_{model_id}.png` after first generation. Subsequent requests serve the cached file directly via `FileResponse`.

**New (suggested):**
> Model heatmaps are cached under `<embedding_dir>/heatmap_cache/` with scoped/versioned keys (e.g., `{project_or_global}_{slide_id}_{model_id}_{truthful|smooth}_v3.png`). Cache reads are used only for default `alpha_power≈0.7`; non-default alpha requests are regenerated.

---

## 3) `PatchOverlay` type definition does not match frontend implementation

**Old (§12.2 “PatchOverlay Type”):**
```typescript
interface PatchOverlay {
    data: Array<{ x: number; y: number; score?: number; class_idx?: number; confidence?: number }>;
    type: "outlier" | "classifier";
    classColors?: string[];
}
```

**New (suggested):**
```typescript
interface PatchOverlay {
    type: "outlier" | "classifier";
    data: Array<{ x: number; y: number; score?: number; classIdx?: number; confidence?: number }>;
    classes?: string[];
}
```