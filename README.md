# Enso Atlas

**On-Prem Pathology Evidence Engine for Treatment-Response Insight**

[![MedGemma Impact Challenge](https://img.shields.io/badge/Kaggle-MedGemma%20Impact%20Challenge-blue)](https://www.kaggle.com/competitions/med-gemma-impact-challenge)

## Overview

Enso Atlas is an on-premise pathology evidence engine that takes whole-slide images (WSIs) and produces:

- **Patient/slide-level prediction score** for treatment response
- **Evidence heatmap** highlighting regions most responsible for the prediction
- **Similarity search** showing the most similar patches/cases from a reference cohort
- **Structured tumor board summary** generated by MedGemma

### Key Features

- ðŸ”’ **Local-first**: Runs entirely on-premise, no PHI leaves the hospital network
- ðŸŽ¯ **Evidence-based**: Heatmaps + patch retrieval + structured reports
- ðŸ”„ **Foundation-model agnostic**: Swap embedders without changing the product
- âš¡ **Efficient**: Embed once, reuse for multiple downstream tasks

## Architecture

```
WSI â†’ Patches â†’ Path Foundation â†’ Attention MIL â†’ Heatmap + FAISS â†’ MedGemma Report
```

### Tech Stack

| Component | Technology |
|-----------|------------|
| WSI I/O | OpenSlide, cuCIM (GPU) |
| Embeddings | Path Foundation (384-dim) |
| MIL Head | CLAM (Attention-based) |
| Retrieval | FAISS |
| Reporting | MedGemma 1.5 4B |
| UI | Gradio + OpenSeadragon |
| Deployment | Docker + NVIDIA Container Toolkit |

## Quick Start

### Prerequisites

- Python 3.10+
- NVIDIA GPU with CUDA support (for training/inference)
- OpenSlide library installed
- Docker (for deployment)

### Installation

```bash
# Clone the repository
git clone https://github.com/Hilo-Hilo/med-gemma-hackathon.git
cd med-gemma-hackathon

# Create virtual environment
python -m venv .venv
source .venv/bin/activate

# Install dependencies
pip install -e .

# Download models (requires HuggingFace access)
python scripts/download_models.py
```

### Run the Demo

```bash
# Start the Gradio interface
python -m enso_atlas.ui.app

# Or use the CLI
enso-atlas analyze path/to/slide.svs --output results/
```

### Docker Deployment

```bash
# Build the container
docker-compose build

# Run (with GPU support)
docker-compose up -d

# Access UI at http://localhost:7860
```

## Dataset

The prototype uses the **Ovarian Bevacizumab Response Dataset** from Nature:

> 288 de-identified H&E WSIs from 78 patients with response labels

Download: [Nature Scientific Data](https://www.nature.com/articles/s41597-022-01127-6)

## Project Structure

```
med-gemma-hackathon/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ wsi/           # WSI processing & tiling
â”‚   â”œâ”€â”€ embedding/     # Path Foundation feature extraction
â”‚   â”œâ”€â”€ mil/           # CLAM attention MIL head
â”‚   â”œâ”€â”€ evidence/      # Heatmaps & FAISS retrieval
â”‚   â”œâ”€â”€ reporting/     # MedGemma report generation
â”‚   â””â”€â”€ ui/            # Gradio interface
â”œâ”€â”€ config/            # YAML configurations
â”œâ”€â”€ docker/            # Dockerfile & compose
â”œâ”€â”€ scripts/           # Utility scripts
â”œâ”€â”€ tests/             # Unit tests
â”œâ”€â”€ data/              # Dataset storage
â””â”€â”€ outputs/           # Generated reports
```

## Usage

### Single Slide Analysis

```python
from enso_atlas import EnsoAtlas

atlas = EnsoAtlas.from_config("config/default.yaml")
result = atlas.analyze("path/to/slide.svs")

print(result.score)
result.save_heatmap("heatmap.png")
result.save_report("report.json")
```

### Batch Processing

```python
from enso_atlas import EnsoAtlas

atlas = EnsoAtlas.from_config("config/default.yaml")
results = atlas.batch_analyze("data/slides/", output_dir="results/")
```

## Submission

For the MedGemma Impact Challenge, see:

- [3-minute demo video](docs/demo.md)
- [Technical writeup](docs/writeup.md)
- [Reproducibility guide](docs/reproduce.md)

## License

MIT License - See [LICENSE](LICENSE)

## Acknowledgments

- Google Health AI for Path Foundation and MedGemma
- NVIDIA for DGX Spark hardware
- The authors of the Ovarian Bevacizumab Response Dataset

## Citation

```bibtex
@software{enso_atlas,
  title = {Enso Atlas: On-Prem Pathology Evidence Engine},
  author = {Wen, Hanson},
  year = {2026},
  url = {https://github.com/Hilo-Hilo/med-gemma-hackathon}
}
```
